Chapter 8 ARIMA 모델

ARIMA 모델은 시계열을 예측하는 또 하나의 접근 방법
지수평활과 ARIMA 모델은 시계열을 예측할 때 가장 널리 사용되는 두 가지 접근 방식
지수평활은 데이터의 추세와 계절성에 대한 설명에 기초,
ARIMA 모델은 데이터에 나타나는 자기상관을 표현하는데 목적

-8.1 정상성과 차분
->정상성을 나타내는 시계열은 시계열의 특징이 해당 시계열이 관측된 시간에 무관
  따라서, 추세나 계절성이 있는 시계열은 정상성을 나타내는 시계열이 아니다.
  백색잡음 시계열은 정상성을 나타내는 시계열이다.
  언제 관찰하는지에 상관이 없고, 시간에 따라 어떤 시점에서 봐도 똑같이 보인다.

-> 로그 같은 변환은 시계열의 분산 변화를 일정하게 만드는데 도움이 될 수 있다.
-> 차분은 시계열의 수준에서 나타나는 변화를 제거하여 시계열의 평균 변화를 일정하게 만드는데 도움
   결과적으로 추세나 계절성이 제거 혹은 감소된다.
-> 정상성 나타내지 않는 시계열 찾을 때 데이터의 시간 그래프나 ACF 그래프 유용
   정상성 나타내면 ACF 비교적 빠르게 0으로 떨어짐

확률보행 모델
-> 차분을 구한 시계열은 T-1개의 값만 가진다.
-> 확률보행 모델은 정상성을 나타내지 않는 데이터, 특별히 금융이나 경제쪽 사용
   1. 누가 봐도 알 수 있는 긴 주기를 갖는 상향 또는 하향 추세 있음
   2. 갑작스럽고 예측할 수 없는 방향 변화가 있다.
-> 예측값은 마지막 관측값과 같다. 

2차 차분 : 1차 차분 후 정상성이 없을 때

계절성 차분 
-> 관측치와 같은 계절의 이전 관측값과의 차이를 말한다.
   계절성으로 차분을 구한 데이터가 백색잡음으로 보이면, 원본 데이터에 대해 적절한 모델은
   예측값은 관련 있는 계절의 마지막 관측값과 같다.

계절성을 나타내는 데이터를 얻기 위해 계절성 차분과 1차 차분 둘다 구하는 것이 필요하기도 하다.
계절성 패턴이 강하게 나타나면, 계절성 차분을 먼저 계산

단위근검정 : 더 객관적으로 차분을 구하는 것이 필요할 지 결정하기 위해 사용하는 한 가지 방법
ex) KPSS 검정, ndiffs(), nsdiffs() - 계절성 차분 필요 여부


-8.2 후방이동 기호 : 시계열 시차를 다룰 때 유용한 표기법 장치
B or L(lag)
데이터를 한 시점 뒤로 옮기는 효과
차분을 나타낼 때 편리 (1-B)^d

-8.3 자기회귀 모델
다중 회귀 모델에서, 목표 예상 변수의 선형 조합을 이용해 관심 있는 변수 예측
자기회귀 모델에선, 변수의 과거 값의 선형 조합을 이용해 관심 있는 변수 예측
(자기 자신에 대한 변수의 회귀라는 의미 내포)

AR(차수) 모델 : 자기회귀 모델
보통은 자기회귀 모델을 정상성을 나타내는 데이터에만 사용한다.
또한 매개변수 값에 대한 몇몇 제한조건이 필요하다.


-8.4 이동 평균 모델
-> 목표 예상 변수의 과거 값을 이용하는 대신에, 과거 예측 오차 이용
   MA(q) 모델

주의 : 이동 평균 모델은 미래 값을 예측할 때 사용,
       이동 평균 평활은 과거 값의 추세-주기를 측정할 때 사용

MA(q) 과정을 AR(inf) 과정으로 쓸 수 있다.

-8.5 비-계절성 ARIMA 모델
->차분을 구하는 것을 자기회귀와 이동 평균 모델과 결합
-> ARIMA는 이동평균을 누적한 자기회귀의 약자
   ARIMA(자기회귀 차수, 1차 차분포함정도, 이동평균 부분 차수)
-> 정상성과 가역성 조건은 ARIMA 모델에도 적용

-> auto.arima() 함수가 p,d,q의 적절한 값 골라줌, 모든 입력 자동 위험할 수 있다.
c=0이고  d=0이면, 장기 예측값이 0에 가까워질 것입니다.
c=0이고  d=1이면, 장기 예측값이 0이 아닌 상수에 가까워질 것입니다.
c=0이고  d=2이면, 장기 예측값이 직선 형태로 나타나게 될 것입니다.
c≠0이고  d=0이면, 장기 예측값이 데이터의 평균에 가까워질 것입니다.
c≠0이고  d=1이면, 장기 예측값이 직선 형태로 나타나게 될 것입니다.
c≠0이고  d=2이면, 장기 예측값이 2차 곡선 추세로 나타나게 될 것입니다.

p값은 데이터에서 주기가 나타날 때 중요

ACF, PACF를 통해 적절한 p와q값을 결정 (p,q 양수이면 도움 x)

부분 자기상관값들 : k번째 부분 자기상관 계수는 AR(k) 모델에서 ϕ 측정값과 같다.

p,d,0 : 
ACF가 지수적으로 감소하거나 사인 함수 모양인 경우;
PACF 그래프에서 시차 p에 뾰족한 막대가 유의미하게 있지만, 시차 p이후에는 없을 때.

0,d,q : 
PACF가 지수적으로 감소하거나 사인 함수 모양인 경우;
ACF 그래프에서 시차 q에 뾰족한 막대가 유의미하게 있지만, 시차 q이후에는 없을 때.

-> auto.arima() 함수는 모든 가능한 모델 고려하지 않는다 !!!!
auto.arima(uschange[,"Consumption"], seasonal=FALSE,
          stepwise=FALSE, approximation=FALSE))

stepwise=FALSE와 approximation=FALSE 입력값으로 더 잘 찾을 수 있다.


-8.6 추정과 차수 선택
p,d,q 찾은 후 매개변수 추정할 때 최대 가능도 추정(MLE) 사용
ARIMA 모델이 회귀 모델을 추정하는 것보다 훨씬 더 복잡하다.
ARIMA 모델에서 차수를 결정할 때 AIC 유용

-8.7 R에서 ARIMA 모델링
auto.arima()는 단위 근 검정, AICc 최소화, MLE 결합 사용
(힌드만-칸다카르 알고리즘)

Arima() 함수 사용시 원하는 모델로 선택 가능
1. 데이터 그래프 나타내고, 특이한 관측값 찾는다.
2. 필요 시 분산 안정화 위해 박스-칵스 변환사용
3. 정상성 위해 필요 시 차분
4. ACF/PACF 살펴본다.
5. 모델을 고르고 더 나은 모델을 찾기 위해 AICc를 이용한다.
6. 잔차의 ACF를 그리고 잔차의 포트맨토 검정을 해 잔차 확인한다.
   백색잡음이 아니면 수정된 모델을 사용한다.
7. 잔차가 백색잡음처럼 보이면, 예측값을 계산한다.

힌드만-칸다카르 알고리즘은 3-5단계만 처리한다.
나머지 과정은 사용자가 선택해야 한다.

-8.8 예측하기
점 예측치
1.yt가 좌변에 오고 다른 모든 항들이 우변에 오도록 ARIMA 식을 전개합니다.
2.t를 T+h로 바꾸어 식을 다시 씁니다.
3.식의 우변에서, 미래 관측값을 예측값으로 바꾸고, 미래 오차값을 0으로 바꾸고, 
  과거 오차값을 해당 잔차로 바꿉니다.

예측구간
1. 95% 예측구간 +-1.96
2. 0,0,q의 경우 다-단계 에측 구간은 예측 분산을 사용해 구함

ARIMA 모델에 대한 예측 구간은 잔차에 상관관계가 없고 잔차가 정규분포를 따른다는 가정에 기초
이러한 이유로 예측구간 내기 전에 항상 ACF와 잔차의 히스토그램 그려봐야한다.

일반적으로, 예측 수평선이 증가할수록 ARIMA 모델로 얻은 예측구간은 증가한다.


-8.9 계절성 ARIMA 모델들
지금까지는 비-계절성 데이터와 비-계절성 ARIMA 모델만 알아봄
auto.arima() 함수 사용해서 얻을 수 있다.
-> 분산이 증가하면 로그를 취해야 한다.
-> 계절성 강하면 계절성 차분 사용
-> 때때로 모든 검정을 통과하는 모델을 찾지 못할 수 있다.
-> 모델이 모든 검정을 통과하지 못하더라도 찾을 수 있었던 가장 좋은 모델을 사용

-8.10 ARIMA vs ETS
선형 지수 평활 모델이 ARIMA 모델의 특수한 경우지만,
비-선형 지수 평활 모델은 ARIMA에 대응되는 부분이 없다.
ETS 모델은 정상성을 나타내지 않는 경우에 맞지만, 몇몇 ARIMA는 정상성이 맞다.
계절성이나 비-감쇠 추세 아니면 둘 다 있는 ETS 모델은 차분 2번 필요
다른 모든 ETS 모델은 1번 차분

EX) 비-계절성 데이터에서 auto.arima(), ets() 비교
    계절성 데이터에서 auto.arima(), ets() 비교
-> 시계열 길면, 교차 검증보다는 학습, 테스트 데이터 나누어 사용
   (1988~2007 데이터)
-> 검증 데이터로 RMSE, MAPE, MASE에 기초하면 ETS 모델이 살짝 더 정확했다.
   이는 학습 데이터를 잘 맞춘다고 모델이 예측을 잘 한다는 것은 아니다.
   
















