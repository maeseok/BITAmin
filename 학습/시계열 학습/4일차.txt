# 시계열 분석

- 4일차
    
Chapter5 시계열 회귀 모델
시계열 y를 예측할 때 이것이 다른 시계열 x와 선형 관계가 있다고 가정

- 선형 모델
1. 단순 선형 회귀 : 종속변수 독립변수 선형 관계
오차 : 관측값이 기본 직선 모델로부터 얼마나 떨어져 있는지를 의미
2. 다중 선형 회귀 : 두 개 이상의 종속변수와 독립변수
-> 잠재적으로 더 정확한 예측값

- 선형 회귀 가정
1. 종속변수와 독립변수 사이의 관계는 선형 관계식을 만족한다.
2. 오차의 평균은 0, 자기상관관계x, 독립변수와 상관관계x
3. 정규분포를 따른다.
4. 독립변수는 확률 변수가 아니다.

- 최소 제곱 추정
제곱 오차의 합을 최소화하여 계수를 효과적으로 선택할 수 있는 방법
tslm() : 선형 회귀 모델을 시계열 데이터에 맞춰준다.
- 적합값
회귀식에서 추정된 계수를 사용하고 오차항을 0으로 두어 y의 예측값을 얻을 수 있다.
(y의 참 미래 예측값이 아니고 모델을 추정하기 위해 사용한 데이터의 예측값)
- 적합도(R^2)
예측값이 실제값과 가까우면 1에 가깝고, 그렇지 않으면 0에 가까움

EX) 다중 0.754, 단순 0.16 -> 종속변수 3개를 더 추가하면 더 잘 설명

- 회귀 분석의 표준 오차
잔차 표준 오차 : 모델이 데이터에 얼마나 잘 들어 맞았는지에 대한 또 다른 척도
(잔차의 표준 편차)

- 회귀 모델 평가
1. 잔차의 ACF 그래프, 브로이쉬-갓프레이 검정 등을 사용해 잔차의 자기상관 확인
2. 잔차의 히스토그램
-> checkresiduals() : 잔차 진단 결과
시간 그래프, 자기상관 그래프, 히스토그램 등을 통해 잔차의 영향 확인
3. 예측변수에 대한 잔차 그래프
-> 잔차가 무작위로 흩뿌려진 형태일 거 같으면 잔차의 산점도를 살펴보면 된다.
-> 모델에 없는 종속변수에 대해 잔차를 그리는 것도 필요하다.
이 중 어떤 것에서 패턴이 나타나면 관련된 종속변수를 모델에 넣어야 한다.
4. 적합값에 대한 잔차 그래프
-> 적합값에 대해 잔차를 그려도 어떠한 패턴도 나타나지 않아야 한다.
패턴이 있다면, 오차에 이분산성이 있을 수 있다. 이는 잔차의 분산이 일정하지 않을 수 있다는 뜻
이런 경우 목표 종속변수에 로그나 제곱근 같은 변환을 취해야할 수 있다.
5. 이상값과 영향력 있는 관측값
-> 회귀 모형의 추정된 계수에 큰 영향을 주는 관측값을 영향력 있는 관측값이라 부른다. (보통 x방향)
이러한 관측값을 제거한 경우와 그렇지 않은 경우 모두 결과를 보고하는 것이 현명하다.
6. 허위회귀
-> 정상성이 나타나지 않는 데이터가 회귀 모델에 어떤 영향을 미치는가?
이는 허위회귀로 이어질 수 있다. 높은 R^2과 높은 잔차 자기 상관은 허위회귀를 나타내는 신호일 수 있다.
허위 회귀는 그럴듯한 단기 예측값을 주는 것처럼 보일 수 있지만, 미래에는 작동하지 않을 것이다.

- 몇 가지 유용한 예측변수
1. 추세
-> 선형 추세는 trend 종속변수를 사용하여 추세 변수를 정할 수 있다.
2. 가변수
-> 종속변수가 범주형 변수일 경우 1,0인 가변수로 만들 수 있다.
이는 데이터의 이상값을 설명할 때도 사용할 수 있다.
3. 계절성 가변수
-> 7개의 범주를 부호화하기 위해서는 6개의 가변수만 필요하다. (가변수 함정)
4. 개입 변수
-> 예측하려는 변수에 영향을 줄 수 있는 개입값을 모델링하는 것이 종종 필요하다.(경쟁자의 활동 등)
효과가 한 주기만 지속되면 스파이크 변수, 즉각적이고 영구적인 효과면 단계 변수
5. 거래일
-> 각 월의 거래일 수를 예측변수로 포함시킬 수 있다.
6. 분포된 시차 값
-> 예시로 광고 효과는 실제 캠페인 기간보다 오래갈 수 있기에, 광고 지출의 시차값을 넣는다.
7. 부활절
-> 매년 날짜가 다르고 효과가 며칠 동안 지속될 수 있기에 대부분의 휴일과는 다르다.
그렇기에 특정 기간에 속하면 가변수를 1로, 그 외는 0으로 둘 수 있다. easter()
8. 푸리에 급수
-> 긴 계절성 주기에 대해서는 특별히 푸리에 항을 사용한다.
푸리에 항이 있으면 가변수가 있는 경우에 필요한 종속변수보다 종종 적은 수의 종속변수를 사용한다.
(EX -> 주별 데이터와 같이 52처럼 큰 계절성에서 푸리에 항이 효과적) -> fourier()로 구현
-> 조화회귀 : 푸리에 항을 포함하는 회귀 모델

- 예측변수 선택 : 회귀 모델에서 종속변수가 많을 때 선택하는 전략
1. 목표 독립변수를 특정한 종속변수에 대해 그래프로 나타내서 눈에 띄는 관계가 없는 경우에 버림
2. 모든 종속변수에 대해 다중 선형 회귀 분석을 하여 p-값 0.05보다 큰 변수 무시 CV() 함수
-> 5가지 측정량(CV, AIC, AICc, BIC, 조정된R^2)
3. 조정된 R^2
-> R^2는 모델이 미래 데이터를 얼마나 잘 예측하는지 측정할 수 없다.
-> 제곱오차의최소합(SSE)를 최소화하는 것은 R^2를 최대화하는 것과 같다.
-> 이러한 문제를 해결한 것이 조정된 R^2이다.
4. 교차검증 : 더 빠르면서 데이터를 더 효과적으로 사용할 수 있다.
->관측값 t를 데이터 모음에서 제거하고, 모델로 나머지 데이터를 맞춥니다. 그리고 생략한 관측값에 대한 오차
(e∗t=yt−^yt)를 계산합니다. ^yt 값을 추정할 때 t번째 관측값이 사용되지 않았기 때문에 잔차와 같지 않습니다.)
->t=1,…,T에 대해 1번 과정을 반복합니다.
->e∗1,…,e∗T로부터 MSE를 계산합니다. 이것을 CV라고 부르겠습니다.
-> 가장 좋은 모델은 CV가 가장 작은 모델이다.
5. 아카이케의 정보 기준(AIC)

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/24efbc82-5174-4d9b-ab43-b8e96a17fb77/e25e89e0-dbc1-4465-9276-3538ff3bc8ae/Untitled.png)

    T는 관측값의 수, k는 종속변수의 수이다.

    AIC값이 최소인 모델은 예측할 때 종종 가장 좋은 모델이다.

1. 수정된 아카이케의 정보 기준(AICc)

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/24efbc82-5174-4d9b-ab43-b8e96a17fb77/e6f51252-ae1e-4456-8c80-75c570612e24/Untitled.png)

    마찬가지로 최소화해야 한다.

1. 슈바르츠의 베이지안 정보 기준(BIC)
    
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/24efbc82-5174-4d9b-ab43-b8e96a17fb77/9735650d-db7a-4f9d-9041-abd7127ed9f0/Untitled.png)
    

가장 좋은 모델을 얻기 위해 BIC를 최소화해야 한다.

→ 결과적으로 AICc, AIC  또는 CV 통계를 주로 사용한다.

- 가장 좋은 부분집합 회귀

가장 좋은 부분집합 회귀 또는 모든 가능한 부분집합 회귀라 한다.

1. 후진 단계적 회귀

모든 잠재적인 종속변수를 포함하는 모델부터 시작한다.

한 번에 하나의 종속변수를 제거한다. 이렇게 하여 예측 정확도가 나아지면 모델을 유지한다.

더 나아지지 않을 때까지 반복한다.

1. 전진 단계적 회귀

절편만 포함하는 모델에서 시작한다.

예측변수 한 번에 하나씩 추가하며, 예측 정확도를 높이는 모델은 유지한다.

더 나아지지 않을 때까지 이 과정을 반복한다.

1. 혼한 절차

후진 절차에 대해 넣는 것도 고려, 전진 절차에 대해 뺴는 것도 고려

- 회귀로 예측하기
1. 사전 예측 대 사후 예측

사전 예상값 : 미리 쓸 수 있는 정보만으로 내는 것

사후 예상값 : 종속변수에 대한 이후 정보로 내는 것

→ 예측 오차가 안 좋은 모델 때문인지, 예측변수에 대한 안 좋은 예측값 때문인지 나타낼 수 있다.

1. 예측 회귀 모델 세우기

목표 독립변수와 종속변수의 중요한 관계를 잡아내는데 사용

사전 예상값을 내기 위해, 각 종속변수의 미래값이 필요

예측변수로 시차 값을 사용하여 문제 해결

- 비선형 회귀

로그 변환을 자주 사용

로그-선형 형태는 목표 독립변수만 변환하여 적고

선형-로그 형태는 종속변수를 변환하여 얻는다.

변수를 로그 변환하기 위해서, 모든 관측된 값이 0보다 커야함

- 비선형 추세로 예측하기

2차 이상의 추세를 사용

예측 작업에서는 2차 이상의 추세 권장X

- 상관관계, 인과관계 그리고 예측

상관관계는 인과관계가 아니다.

혼선자 : 어떤 변수가 반응변수와 하나 이상의 종속 변수 모두에 영향을 주는 것

상관관계는 예측 작업에서는 유용하다.

- 상관관계를 가지는 예측변수로 예측하기

상관관계 가지는 예측변수 나누는 것은 어렵지만 예측은 가능

하지만 시나리오와 기여도에 대한 데이터 분석은 어려움

- 다중공선성과 예측

다중공선성: 다중 회귀에 2개 이상의 예측변수로 비슷한 정보가 주어질 때 나타남

이 성질은 두 종속변수의 상관관계가 아주 높은 상황에서 나타날 수 있다.

또한 종속변수의 선형결합이 종속변수의 다른 선형결합과 매우 상관관계가 높을 때도 나타날 수 있다.

완벽한 상관관계의 경우에는 회귀 모델을 추정할 수 없다.

결과적으로 회귀 계수에 대한 T검정을 신뢰할 수 없다.